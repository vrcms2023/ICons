import{r as c,f as q,ae as $,j as s,T as z,B as D,c as x,d as b,ax as G,o as I,ag as K}from"./index-BWK7iHxT.js";import{E as Q}from"./Error-B_8W099F.js";const X=()=>{const[o,f]=c.useState([]),[N,y]=c.useState(""),[h,j]=c.useState([]),[P,O]=c.useState([]),[S,w]=c.useState(""),[_,p]=c.useState(!1),[u,M]=c.useState([]),[m,n]=c.useState([]),[d,g]=c.useState({}),{userInfo:C}=q(e=>e.auth);c.useEffect(()=>{$(C)&&y(C.id)},[C]);const T=async()=>{var e;try{const t=await x.get("/user/auth/users/");(t==null?void 0:t.status)===200&&((e=t.data)==null?void 0:e.length)>0?f(t.data):f([])}catch{b.error("Unable to load user details")}},B=async()=>{var e,t;try{const a=await x.get("/pageMenu/createPageMenu/");if((a==null?void 0:a.status)===200&&((t=(e=a==null?void 0:a.data)==null?void 0:e.PageDetails)==null?void 0:t.length)>0){const i=JSON.parse(JSON.stringify(a.data.PageDetails));O(i),j(G(a.data.PageDetails))}else j([])}catch{b.error("Unable to load user details")}};c.useEffect(()=>{T(),B()},[]);const J=e=>{p(!_);const t=P.map(a=>({id:a.id,name:a.page_url?a.page_url:a.page_label}));n(t),_&&n([])},L=(e,t)=>{const{id:a,checked:i}=e.target;n([]),p(!1),w(""),M([...u,{id:a,user:t}]),i&&H(a),i||M(u.filter(r=>r.id!==a))},R=e=>{const{id:t,name:a,checked:i}=e.target;p(!1),n([...m,{id:t,name:a}]),i||n(m.filter(r=>r.id!==t))},U=(e,t)=>e.filter(i=>i.id===t).length>0,F=(e,t,a)=>$(e)?t.length===0?void 0:!(t.filter(r=>r.id===a).length>0):!0,v=async()=>{var i,r,E;const e=(i=u[0])==null?void 0:i.user;if(!e){w("Please select user"),window.scrollTo(0,0);return}const t=d==null?void 0:d.id,a={user_name:e.userName,user_id:e.id,user_email:e.email,user_permission_list:m,created_by:I("userName")};t&&(d.user_permission_list=m,d.updated_by=I("userName"));try{let l="";t?l=await x.patch(`/pagePermission/updatePermissions/${t}/`,d):l=await x.post("/pagePermission/createPermissions/",a),((l==null?void 0:l.status)===201||(l==null?void 0:l.status)===200)&&((r=l==null?void 0:l.data)!=null&&r.userPermissions)?(g((E=l==null?void 0:l.data)==null?void 0:E.userPermissions),b.success("Permission are update successfully")):g({})}catch{b.error("Unable to save user permission")}},H=async e=>{var t,a;try{const i=await x.get(`/pagePermission/updatePermissions/${e}/`);if((i==null?void 0:i.status)===200&&((t=i==null?void 0:i.data)!=null&&t.userPermissions)){const r=(a=i==null?void 0:i.data)==null?void 0:a.userPermissions;g(r),n(r.user_permission_list),P.length===r.user_permission_list.length&&p(!0)}else g({})}catch{console.log("Unable to load user details"),g({})}},A=({menu:e})=>{var t;return s.jsx(K.Fragment,{children:e.is_Maintainer_menu&&s.jsxs("li",{className:`list-group-item ${e.childMenu?"":"d-flex justify-content-between align-items-start"}`,children:[s.jsx("span",{className:`${e.is_Parent?"fw-bold":"child"}`,children:e.page_label}),e.childMenu?"":s.jsx("span",{className:"badge",children:s.jsx(k,{type:"checkbox",name:e.page_url,id:e.id,handleClick:R,isChecked:U(m,e.id),disabled:!1},e.id)}),((t=e.childMenu)==null?void 0:t.length)>0?s.jsx("ul",{className:"list-group",children:e.childMenu.map(a=>s.jsx(A,{menu:a},a.id))}):""]})},e.id)};return s.jsxs("div",{className:"container-fluid pt-5",children:[s.jsx("div",{className:"row px-3 px-lg-5",children:s.jsxs("div",{className:"text-end d-flex justify-content-between align-items-center",children:[s.jsx(z,{title:"User's page Permission",cssClass:"fs-1 pageTitle"}),s.jsx(D,{type:"submit",cssClass:"btn btn-primary",label:"save",handlerChange:v})]})}),s.jsxs("div",{className:"row px-3 px-lg-5 py-4",children:[s.jsxs("div",{className:"col-md-5",children:[S?s.jsx(Q,{children:S}):"",s.jsxs("table",{className:"table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Email"}),s.jsx("th",{children:"Select"})]})}),s.jsx("tbody",{children:o==null?void 0:o.map(e=>s.jsxs("tr",{children:[s.jsx("td",{className:`${e.is_admin?"text-danger":""}`,children:e.userName}),s.jsx("td",{className:`${e.is_admin?"text-danger":""}`,children:e.email}),s.jsx("td",{className:`${e.is_admin?"text-danger":""}`,children:e.id!==N&&!e.is_admin?s.jsx(k,{type:"checkbox",name:e.userName,id:e.id,handleClick:t=>{L(t,e)},isChecked:U(u,e.id.toString()),disabled:F(e,u,e.id.toString())},e.id):""})]},e.id))})]})]}),s.jsxs("div",{className:"col-md-7 bg-light p-4",children:[s.jsx("ul",{className:"list-group list-group-flush",children:s.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-start bg-warning",children:["Select All",s.jsx("span",{className:"badge",children:s.jsx(k,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:J,isChecked:_})})]})}),s.jsx("ul",{className:"list-group list-group-flush",children:h==null?void 0:h.map(e=>s.jsx(A,{menu:e},e.id))})]})]}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"d-flex justify-content-center align-items-center gap-1 gap-md-3 ",children:s.jsx(D,{type:"submit",cssClass:"btn btn-primary",label:"save",handlerChange:v})})})]})},k=({id:o,type:f,name:N,handleClick:y,isChecked:h,disabled:j})=>s.jsx("input",{id:o,name:N,type:f,onChange:y,checked:h,disabled:j,className:"form-check-input border border-secondary"});export{X as default};
