import{h as J,u as K,r as d,W as Q,j as e,E as X,I as F,av as V,V as Y,B as Z,_ as q,o as R,C as $,d as A,f as L,e as ee,L as E,T as se,aw as B,M as te,c as k,ax as W,a4 as ae,t as ne,v as z,ay as le}from"./index-BWK7iHxT.js";import{l as re}from"./DeleteDialog-DnRfuXBp.js";import{D as ie}from"./DeleteDialog-sO22D6fc.js";import{E as ce}from"./Error-B_8W099F.js";import{a as oe,u as ue}from"./menuUtil-BoWK6jXD.js";import{D as pe,C as de,P as he}from"./dnd.esm-DtnQK6qL.js";const xe=({editHandler:O,menuList:u,editMenu:n,componentType:N,popupTitle:H})=>{const w=J(),C=()=>{O(N,!1),document.body.style.overflow=""},{register:x,reset:T,handleSubmit:D}=K({defaultValues:d.useMemo(()=>n,[n])}),[j,b]=d.useState(!1),[g,P]=d.useState(n?!!(n!=null&&n.is_Parent):!0),[v,S]=d.useState(n?!!(n!=null&&n.is_Admin_menu):!0),[m,I]=d.useState(n?!!(n!=null&&n.is_Client_menu):!0),[U,M]=d.useState([]),[s,l]=d.useState(Q(15)),a=t=>{t.forEach(o=>{for(var h=0;h<s.length;)s[h].value===o.page_position?s.splice(h,1):h++}),l(s)};d.useEffect(()=>{let t=[];u.length>0&&(u.forEach(o=>{let h={label:o.page_label,value:o.id,page_position:o.page_position};t.push(h)}),M(t),a(t))},[u]),d.useEffect(()=>{T(n),n!=null&&n.id&&r()},[n]);const r=()=>{const o=[{label:n==null?void 0:n.page_position,value:n==null?void 0:n.page_position}].concat(s);l(o)},c=async t=>{var o,h;if(!(t!=null&&t.page_label))return b("Please enter menu label"),!0;if(!((o=t==null?void 0:t.page_url)!=null&&o.startsWith("/",0)))return b("Menu url should be starting with /"),!0;if(t.is_Parent)t.page_position=(u==null?void 0:u.length)>0?(u==null?void 0:u.length)+1:1;else{if(parseInt(t==null?void 0:t.page_parent_ID)===0)return b("Please select parent menu"),!0;const p=q.filter(u,G=>G.id===t.page_parent_ID)[0];t.page_url=p.page_url+t.page_url,t.page_position=oe(p)}t!=null&&t.id?t.updated_by=R("userName"):t.created_by=R("userName"),t.page_isActive=!0,t.is_Admin_menu=!0,JSON.stringify(t);try{let p=await ue(t);((p==null?void 0:p.status)===201||(p==null?void 0:p.status)===200)&&((h=p==null?void 0:p.data)!=null&&h.PageDetails)&&(C(),w($()))}catch{A.error("Unable to load user details")}},i=()=>{P(!g)},f=()=>{S(!v)},_=()=>{I(!m)},y=()=>{b("")};return e.jsxs(e.Fragment,{children:[e.jsx(X,{closeHandler:C,title:H}),e.jsx("div",{className:"container",children:e.jsx("div",{className:"row py-0 pb-md-5",children:e.jsxs("div",{className:"col-md-8 offset-md-2 mb-5 mb-md-0",children:[j&&e.jsx("div",{className:"fw-bold",children:j&&e.jsx(ce,{children:j})}),e.jsxs("form",{onSubmit:D(c),children:[e.jsx(F,{label:"Menu Lable",type:"text",fieldName:"page_label",register:x,onChange:y},0),e.jsx(F,{label:"Menu URL",type:"text",fieldName:"page_url",register:x,onChange:y},1),e.jsx("br",{}),e.jsx(V,{label:"is Parent Menu",fieldName:"is_Parent",register:x,onChange:i,isChecked:g}),e.jsx(V,{label:"is Maintainer Menu",fieldName:"is_Maintainer_menu",register:x,onChange:f,isChecked:v}),e.jsx(V,{label:"is Client Menu",fieldName:"is_Client_menu",register:x,onChange:_,isChecked:m}),!g&&e.jsx(Y,{label:"Parent Menu list",fieldName:"page_parent_ID",register:x,options:U}),e.jsxs("div",{className:"d-flex justify-content-center flex-wrap flex-column flex-sm-row align-items-center gap-1 gap-md-3 mt-5",children:[e.jsx("button",{className:"btn btn-secondary mx-3",children:"save"}),e.jsx(Z,{type:"submit",cssClass:"btn border",label:"Close",handlerChange:C})]})]})]})})})]})},ye=()=>{const O={menu:!1},[u,n]=d.useState([]),[N,H]=d.useState(O),[w,C]=d.useState(!1),[x,T]=d.useState({}),{userInfo:D}=L(s=>s.auth),j=J(),{hasPermission:b}=ee(),g=(s,l,a)=>{T(a),H(r=>({...r,[s]:l})),C(!w),document.body.style.overflow="hidden"},P=async()=>{var s,l;try{const a=await k.get("/pageMenu/createPageMenu/");if((a==null?void 0:a.status)===200&&((l=(s=a==null?void 0:a.data)==null?void 0:s.PageDetails)==null?void 0:l.length)>0){const r=W(a.data.PageDetails);n(r)}else n([])}catch{A.error("Unable to load user details")}};d.useEffect(()=>{N.menu||P()},[N.menu]);const v=s=>{const l=s.id,a=s.page_label,r=async()=>{(await k.delete(`/pageMenu/updatePageMenu/${l}/`)).status===204&&(A.success(`${a} Memu is delete successfully `),P(),j($()))};re.confirmAlert({customUI:({onClose:c})=>e.jsx(ie,{onClose:c,callback:r,message:`you want to delete the ${a} Menu`})})},S=async(s,l,a)=>{if(l.is_Parent)await m(s,l,a);else{const r=q.filter(u,c=>c.id===l.page_parent_ID)[0];r[a]?await m(s,l,a):(await m(r.id,r,a),await m(s,l,a))}},m=async(s,l,a)=>{l[a]=!l[a];try{(await k.patch(`/pageMenu/updatePageMenu/${s}/`,l)).status===200&&P()}catch{A.error("Unable to load user details")}},I=()=>e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Menu Lable"}),e.jsx("th",{children:"URL"}),e.jsx("th",{children:"Menu type"}),e.jsx("th",{className:"text-center",children:"Page Publish "}),e.jsx("th",{className:"text-center",children:"Admin Pages to View"}),e.jsx("th",{className:"text-center",children:"Action"})]})}),U=({node:s,ind:l})=>{const[a,r]=d.useState(!1),c=()=>{r(!a)};return e.jsx(he,{draggableId:s.id,index:l,id:s.id,children:(i,f)=>{var _;return e.jsxs(e.Fragment,{children:[B(D,s.is_Admin_menu)&&e.jsxs("tr",{ref:i.innerRef,...i.draggableProps,...i.dragHandleProps,style:le(f.isDragging,i.draggableProps.style),children:[e.jsxs("td",{className:"p-2 ",children:[((_=s.childMenu)==null?void 0:_.length)>0?e.jsx("i",{className:`fa ${a?"fa-minus":"fa-plus"} mx-2`,"aria-hidden":"true",onClick:c}):e.jsx("i",{className:"fa lableIconPlaceholder mx-2","aria-hidden":"true"}),s.page_label]}),e.jsx("td",{children:e.jsx(E,{to:s.page_url,children:s.page_url})}),e.jsx("td",{children:s.is_Parent?"Parent Menu":"Child Menu"}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:s.is_Client_menu,readOnly:!0,onClick:()=>{S(s.id,s,"is_Client_menu")},className:"form-check-input border border-secondary"})}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"checkbox",checked:s.is_Maintainer_menu,readOnly:!0,onClick:()=>{S(s.id,s,"is_Maintainer_menu")},className:"form-check-input border border-secondary"})}),e.jsxs("td",{className:"text-center",children:[e.jsx(E,{to:"",onClick:()=>g("menu",!0,s),className:"p-2",children:e.jsx("i",{className:"fa fa-pencil text-warning cursor-pointer fs-5","aria-hidden":"true"})}),e.jsx(E,{to:"",className:" ms-4",onClick:()=>v(s),children:e.jsx("i",{className:"fa fa-trash-o fs-4 text-danger","aria-hidden":"true",title:"Delete"})})]})]}),a&&s.childMenu.length>0&&e.jsx("tr",{className:"p-0",id:`${s.id}-page`,children:e.jsx("td",{colSpan:"8",className:"p-0 ",children:e.jsxs("table",{className:"table mt-4 mb-4  w-100 border",children:[I(),e.jsx(M,{treeData:s.childMenu})]})})})]})}},s.id)},M=({treeData:s})=>{const l=async r=>{const{source:c,destination:i}=r;if(!i)return!0;const f=ne(u,c.index,i.index),_=z(f,"page_position"),y=[];_.forEach(o=>{var h;if(y.push(o),((h=o.childMenu)==null?void 0:h.length)>0){const p=z(o.childMenu,"page_position",o.page_position);y.push(...p)}});const t=await a(y);if(t.length>0){const o=W(t);n(o)}j($())},a=async r=>{var c;try{let i=await k.put("/pageMenu/updateindex/",r);if((c=i==null?void 0:i.data)!=null&&c.PageDetails)return i.data.PageDetails}catch{console.log("unable to save menu position")}};return e.jsx(pe,{onDragEnd:l,children:s.map((r,c)=>e.jsx(de,{droppableId:`${c}`,children:(i,f)=>e.jsxs("tbody",{ref:i.innerRef,style:ae(f.isDraggingOver),...i.droppableProps,children:[e.jsx(U,{node:r,ind:c},r.id),i.placeholder]})},c))})};return e.jsxs("div",{className:"container-fluid pt-5",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("div",{className:"text-end",children:e.jsxs(E,{className:"btn btn-primary",onClick:()=>g("menu",!0),children:["Add ",e.jsx("i",{className:"fa fa-plus mx-2","aria-hidden":"true"})]})}),N.menu&&e.jsx("div",{className:"adminEditTestmonial selected ",children:e.jsx(xe,{editHandler:g,menuList:u,popupTitle:"Menu",editMenu:x,componentType:"menu"})})]}),e.jsx("div",{className:"row px-3 px-lg-5",children:e.jsx("div",{className:"text-end d-flex justify-content-between",children:e.jsx(se,{title:"Menu Administration",cssClass:"fs-1 pageTitle"})})}),e.jsx("div",{className:"row px-3 px-lg-5 py-4 table-responsive",children:B(D,b)?e.jsxs("table",{className:"table table-striped",children:[I(),u.length>0&&e.jsx(M,{treeData:u})]}):e.jsx("h3",{children:"Not authorized to view this page "})}),w&&e.jsx(te,{})]})};export{ye as default};
